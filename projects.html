<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIME360.AI - Проекты</title>
    <link rel="icon" type="image/png" href="img/icon prime360.png">
    <link rel="apple-touch-icon" href="img/icon prime360.png">
    <link rel="stylesheet" href="css/index.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e5e5e7;
            padding: 20px 0;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 20px 30px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: white;
            border: 2px solid #000000;
            border-radius: 8px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000000;
            font-weight: bold;
            padding: 2px;
            font-size: 14px;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        /* Mobile responsive styles for logo */
        @media (max-width: 768px) {
            .logo-icon {
                width: 28px;
                height: 28px;
                font-size: 11px;
                background: white;
                border: 2px solid #000000;
                padding: 1px;
            }
            
            .logo-icon img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                border-radius: 4px;
            }
        }

        @media (max-width: 375px) {
            .logo-icon {
                width: 24px;
                height: 24px;
                font-size: 10px;
                background: white;
                border: 1px solid #000000;
                padding: 1px;
            }
            
            .logo-icon img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                border-radius: 3px;
            }
        }

        .logo-text {
            font-weight: 700;
            font-size: 16px;
            color: #333;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: #f8f9ff;
            color: #70B8B8;
            border-left-color: #70B8B8;
        }

        .menu-item.active {
            background: #f8f9ff;
            color: #70B8B8;
            border-left-color: #70B8B8;
            font-weight: 600;
        }

        .menu-icon {
            margin-right: 12px;
            font-size: 16px;
        }


        .ai-assistant {
            margin: 30px 20px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
            border: 1px solid #e0e7ff;
        }

        .ai-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .ai-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .ai-description {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .ai-button {
            width: 100%;
            padding: 10px;
            background: #70B8B8;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .ai-button:hover {
            background: #5a9a9a;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e5e7;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 30px;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            background: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #70B8B8;
            background: white;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: #666;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #70B8B8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .logout-button {
            padding: 8px 16px;
            background: #f3f4f6;
            color: #666;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-button:hover {
            background: #e5e5e7;
            color: #333;
        }

        .content-header {
            background: white;
            border-bottom: 1px solid #e5e5e7;
            padding: 20px 30px;
        }

        .content-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .title-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .title-text {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }


        .invite-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: #70B8B8;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .invite-button:hover {
            background: #5a9a9a;
        }

        .project-tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e5e7;
        }

        .tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f8f9fa;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            background: #e5e5e7;
            color: #333;
        }

        .tab-button.active {
            background: #70B8B8;
            color: white;
            border-color: #70B8B8;
        }

        .tab-button.active:hover {
            background: #5a9a9a;
        }

        .invite-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
        }


        .content-body {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .project-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e5e5e7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #70B8B8;
        }

        .project-card h3 {
            margin: 0 0 16px 0;
            color: #333;
            font-size: 18px;
        }

        .project-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-green {
            background: #10b981;
        }

        .progress-orange {
            background: #f59e0b;
        }

        .progress-blue {
            background: #3b82f6;
        }

        .project-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-deadline {
            color: #666;
            font-size: 12px;
        }

        .project-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .status-active {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-planning {
            background: #dbeafe;
            color: #0284c7;
        }

        .status-completed {
            background: #dcfce7;
            color: #16a34a;
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e5e7;
            padding: 30px;
        }

        .stats-title {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }


        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .stat-green {
            color: #10b981;
        }

        .stat-blue {
            color: #3b82f6;
        }

        .stat-orange {
            color: #f59e0b;
        }

        .stat-red {
            color: #ef4444;
        }

        /* PDF Modal Styles */
        .pdf-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .pdf-modal-content {
            position: relative;
            margin: 2% auto;
            width: 90%;
            height: 90%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .pdf-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .pdf-modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
        }

        .pdf-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .pdf-modal-close:hover {
            background: #e2e8f0;
            color: #1e293b;
        }

        .pdf-modal-body {
            height: calc(100% - 80px);
            padding: 0;
        }

        .pdf-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .charter-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .charter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* New Project Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background: linear-gradient(135deg, #70B8B8 0%, #5a9a9a 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.2s;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
            min-height: 0; /* Важно для flex-элементов */
            max-height: calc(90vh - 140px); /* Учитываем заголовок и футер */
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #70B8B8;
        }

        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.2s;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #70B8B8;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s;
        }

        .form-select:focus {
            outline: none;
            border-color: #70B8B8;
        }

        .modal-footer {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-primary {
            background: linear-gradient(135deg, #70B8B8 0%, #5a9a9a 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a9a9a 0%, #4a8a8a 100%);
        }

        .word-download-btn {
            background: #f8f9fa;
            color: #70B8B8;
            border: 2px solid #70B8B8;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .word-download-btn:hover {
            background: #70B8B8;
            color: white;
        }

        .delete-project-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
        }

        .delete-project-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .pdf-upload-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-right: 5px;
        }

        .pdf-upload-item {
            display: flex;
            flex-direction: column;
        }

        .pdf-upload-item input[type="file"] {
            border: 2px dashed #70B8B8;
            background: white;
            transition: all 0.2s;
        }

        .pdf-upload-item input[type="file"]:hover {
            border-color: #5a9a9a;
            background: #f8f9ff;
        }

        .pdf-upload-item input[type="file"]:focus {
            border-color: #70B8B8;
            background: white;
        }

        /* Custom scrollbar styles */
        .modal-body::-webkit-scrollbar,
        .pdf-upload-section::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track,
        .pdf-upload-section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb,
        .pdf-upload-section::-webkit-scrollbar-thumb {
            background: #70B8B8;
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover,
        .pdf-upload-section::-webkit-scrollbar-thumb:hover {
            background: #5a9a9a;
        }

        /* Firefox scrollbar */
        .modal-body,
        .pdf-upload-section {
            scrollbar-width: thin;
            scrollbar-color: #70B8B8 #f1f1f1;
        }

        /* Дополнительные стили для гарантии прокрутки */
        .modal-content {
            position: relative;
        }

        .modal-body {
            position: relative;
            z-index: 1;
        }

        /* Убеждаемся, что контент может прокручиваться */
        .modal-body > * {
            position: relative;
        }

        /* Responsive Design for Modal */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 2% auto;
                max-height: 95vh;
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-title {
                font-size: 18px;
            }

            .modal-body {
                padding: 20px;
                max-height: calc(95vh - 120px); /* Учитываем заголовок и футер */
                overflow-y: auto;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-label {
                font-size: 14px;
            }

            .form-input,
            .form-textarea,
            .form-select {
                padding: 10px 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .modal-footer {
                padding: 15px 20px;
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                padding: 14px 24px;
                font-size: 16px;
            }

            .pdf-upload-section {
                gap: 12px;
                max-height: 250px;
            }

            .pdf-upload-item {
                margin-bottom: 10px;
            }

            .pdf-upload-item input[type="file"] {
                padding: 8px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                width: 98%;
                margin: 1% auto;
                border-radius: 8px;
                max-height: 98vh;
            }

            .modal-body {
                padding: 12px;
                max-height: calc(98vh - 120px); /* Учитываем заголовок и футер */
            }

            .modal-header {
                padding: 12px 15px;
            }

            .modal-title {
                font-size: 16px;
            }

            .modal-body {
                padding: 15px;
            }

            .form-group {
                margin-bottom: 12px;
            }

            .form-label {
                font-size: 13px;
                margin-bottom: 6px;
            }

            .form-input,
            .form-textarea,
            .form-select {
                padding: 8px 10px;
                font-size: 14px;
            }

            .form-textarea {
                min-height: 60px;
            }

            .modal-footer {
                padding: 12px 15px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .pdf-upload-section {
                gap: 10px;
                max-height: 200px;
            }

            .pdf-upload-item label {
                font-size: 13px;
            }

            .pdf-upload-item input[type="file"] {
                padding: 6px;
                font-size: 13px;
            }

            .close {
                font-size: 24px;
                min-width: 40px;
                min-height: 40px;
            }
        }

        /* Landscape orientation for mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .modal-content {
                max-height: 90vh;
            }

            .modal-body {
                padding: 15px;
                max-height: calc(90vh - 100px);
                overflow-y: auto;
            }

            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Large screens */
        @media (min-width: 1200px) {
            .modal-content {
                max-width: 700px;
            }

            .form-row {
                gap: 25px;
            }

            .modal-body {
                padding: 35px;
            }

            .modal-header {
                padding: 25px 35px;
            }

            .modal-footer {
                padding: 25px 35px;
            }
        }
    </style>
    <!-- User Profile Script -->
    <script src="js/user-profile.js"></script>
    <!-- Search System -->
    <link rel="stylesheet" href="css/search-system.css">
    <script src="js/search-system.js"></script>
    <!-- Mobile Responsive -->
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <script src="js/mobile-menu.js"></script>
    <script>
        // Функция фильтрации проектов
        function filterProjects(status) {
            // Убираем активный класс со всех кнопок
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Добавляем активный класс к нажатой кнопке
            event.target.classList.add('active');
            
            // Получаем все карточки проектов
            const projectCards = document.querySelectorAll('.project-card');
            
            // Показываем/скрываем карточки в зависимости от фильтра
            projectCards.forEach(card => {
                const cardStatus = card.getAttribute('data-status');
                
                if (status === 'active') {
                    card.style.display = cardStatus === 'active' ? 'block' : 'none';
                } else if (status === 'completed') {
                    card.style.display = cardStatus === 'completed' ? 'block' : 'none';
                }
            });
            
            // Обновляем статистику
            updateStats(status);
        }

        // Инициализация - показываем только действующие проекты по умолчанию
        // Функция инициализации статичных проектов
        function initializeStaticProjects() {
            const staticProjects = [
                {
                    id: 'zhk-progress',
                    name: 'ЖК Прогресс',
                    description: 'Строительство жилого комплекса в центре города',
                    status: 'active',
                    progress: 75,
                    budget: 50,
                    duration: 18,
                    color: 'green',
                    createdAt: '2024-01-15T00:00:00.000Z',
                    isStatic: true
                },
                {
                    id: 'astana-plaza',
                    name: 'Астана Plaza',
                    description: 'Торгово-офисный комплекс в столице',
                    status: 'completed',
                    progress: 100,
                    budget: 80,
                    duration: 24,
                    color: 'orange',
                    createdAt: '2023-06-01T00:00:00.000Z',
                    completedAt: '2024-01-15T00:00:00.000Z',
                    isStatic: true
                },
                {
                    id: 'solar-station',
                    name: 'Солнечная Электростанция',
                    description: 'Строительство солнечной электростанции мощностью 10 МВт',
                    status: 'completed',
                    progress: 100,
                    budget: 120,
                    duration: 12,
                    color: 'blue',
                    createdAt: '2023-03-01T00:00:00.000Z',
                    completedAt: '2024-02-01T00:00:00.000Z',
                    isStatic: true
                },
                {
                    id: 'office-center',
                    name: 'Офисный центр',
                    description: 'Современный офисный комплекс класса А',
                    status: 'planning',
                    progress: 25,
                    budget: 60,
                    duration: 15,
                    color: 'blue',
                    createdAt: '2024-02-01T00:00:00.000Z',
                    isStatic: true
                }
            ];

            // Проверяем, есть ли уже статичные проекты в localStorage
            const existingProjects = loadProjectsFromStorage();
            const hasStaticProjects = existingProjects.some(p => p.isStatic);
            
            if (!hasStaticProjects) {
                // Добавляем статичные проекты в localStorage
                const allProjects = [...staticProjects, ...existingProjects];
                localStorage.setItem('savedProjects', JSON.stringify(allProjects));
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Инициализируем статичные проекты
            initializeStaticProjects();
            
            // Загружаем сохраненные проекты
            displaySavedProjects();
            
            // Устанавливаем активный фильтр по умолчанию
            filterProjects('active');
        });

        // PDF Modal Functions
        function openPdfModal(projectName) {
            document.getElementById('pdfModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Обновляем заголовок в зависимости от проекта
            const title = document.querySelector('.pdf-modal-title');
            title.textContent = `Устав проекта ${projectName}`;
        }

        function closePdfModal() {
            document.getElementById('pdfModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Функция показа уведомления для устава проекта
        function showCharterAlert(projectName) {
            alert(`Подтвердите действие\n\nОткрытие раздела: Устав проекта "${projectName}"\n\nЗдесь будет добавлен PDF файл в будущем.`);
        }

        // Функция открытия модального окна бюджета проекта
        function openBudgetModal(projectName) {
            // Удаляем существующее модальное окно, если есть
            const existingModal = document.getElementById('budgetModal');
            if (existingModal) {
                existingModal.remove();
            }

            const modalHTML = `
                <div id="budgetModal" style="display: block !important; position: fixed !important; z-index: 9999 !important; left: 0 !important; top: 0 !important; width: 100% !important; height: 100% !important; background-color: rgba(0,0,0,0.8) !important; backdrop-filter: blur(5px) !important;">
                    <div style="position: relative !important; margin: 2% auto !important; width: 95% !important; max-width: 1200px !important; max-height: 90vh !important; background: white !important; border-radius: 12px !important; box-shadow: 0 20px 60px rgba(0,0,0,0.3) !important; overflow: hidden !important;">
                        <div style="display: flex !important; justify-content: space-between !important; align-items: center !important; padding: 20px 30px !important; background: #f8fafc !important; border-bottom: 1px solid #e2e8f0 !important;">
                            <h2 style="margin: 0 !important; font-size: 20px !important; font-weight: 600 !important; color: #1e293b !important;">Бюджет проекта "${projectName}"</h2>
                            <button onclick="closeBudgetModal()" style="background: none !important; border: none !important; font-size: 24px !important; cursor: pointer !important; color: #64748b !important; padding: 5px !important; border-radius: 6px !important; transition: all 0.2s !important;">&times;</button>
                        </div>
                        <div style="padding: 30px !important; max-height: calc(90vh - 100px) !important; overflow-y: auto !important;">
                            <div style="overflow-x: auto !important; margin-bottom: 20px !important;">
                                <table style="width: 100% !important; border-collapse: collapse !important; font-size: 14px !important; background: white !important; border: 1px solid #e5e7eb !important; border-radius: 8px !important; overflow: hidden !important;">
                                    <thead>
                                        <tr style="background: #f8fafc !important;">
                                            <th style="padding: 12px !important; text-align: left !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 200px !important;">Наименование</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 120px !important;">Дата начала</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 120px !important;">Дата окончания</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">Бюджет всего</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">План финансирования</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">Оплата, всего</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">Остаток по проекту</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">План на текущий год</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">Оплата за текущий год</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 100px !important;">Остаток на текущий год</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 80px !important;">1 кв</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 80px !important;">2 кв</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 80px !important;">3 кв</th>
                                            <th style="padding: 12px !important; text-align: center !important; font-weight: 600 !important; color: #374151 !important; border-bottom: 2px solid #e5e7eb !important; min-width: 80px !important;">4 кв</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="padding: 12px !important; font-weight: 600 !important; color: #1f2937 !important; border-bottom: 1px solid #e5e7eb !important;">Проектно-изыскательские работы</td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2024-01-15" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2024-06-30" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="15000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="15000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="12000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="3000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="8000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="6000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 12px !important; font-weight: 600 !important; color: #1f2937 !important; border-bottom: 1px solid #e5e7eb !important;">Поставка оборудования</td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2024-07-01" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2024-12-31" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="25000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="25000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="18000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="7000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="12000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="10000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="2000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="3000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="3000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="3000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="3000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 12px !important; font-weight: 600 !important; color: #1f2937 !important; border-bottom: 1px solid #e5e7eb !important;">Строительно-монтажные работы</td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2025-01-01" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="date" value="2025-12-31" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="35000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="35000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="25000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="10000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="20000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="15000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="5000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="5000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="5000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="5000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                            <td style="padding: 8px !important; border-bottom: 1px solid #e5e7eb !important;"><input type="number" value="5000000" style="width: 100% !important; padding: 6px !important; border: 1px solid #d1d5db !important; border-radius: 4px !important; font-size: 12px !important; text-align: center !important;"></td>
                                        </tr>
                                        <tr style="background: #f8fafc !important; font-weight: 600 !important;">
                                            <td style="padding: 12px !important; color: #1f2937 !important; border-bottom: 2px solid #e5e7eb !important;">В С Е Г О</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">-</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">-</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">75,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">75,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">55,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">20,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">35,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">31,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">4,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #e5e7eb !important; text-align: center !important; color: #374151 !important;">10,000,000</td>
                                        </tr>
                                        <tr style="background: #e0f2fe !important; font-weight: 700 !important;">
                                            <td style="padding: 12px !important; color: #0c4a6e !important; border-bottom: 2px solid #0ea5e9 !important;">Итого по ПИП</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">-</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">-</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">75,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">75,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">55,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">20,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">35,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">31,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">4,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">10,000,000</td>
                                            <td style="padding: 8px !important; border-bottom: 2px solid #0ea5e9 !important; text-align: center !important; color: #0c4a6e !important;">10,000,000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-top: 20px; text-align: center;">
                                <button onclick="saveBudgetData('${projectName}')" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; margin-right: 10px; cursor: pointer;">💾 Сохранить</button>
                                <button onclick="loadBudgetData('${projectName}')" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; margin-right: 10px; cursor: pointer;">📁 Загрузить</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Функция закрытия модального окна бюджета
        function closeBudgetModal() {
            const modal = document.getElementById('budgetModal');
            if (modal) {
                modal.remove();
            }
        }

        // Функция сохранения данных бюджета
        function saveBudgetData(projectName) {
            const inputs = document.querySelectorAll('#budgetModal input');
            const data = {};
            
            inputs.forEach((input, index) => {
                data[`field_${index}`] = input.value;
            });
            
            localStorage.setItem(`budgetData_${projectName}`, JSON.stringify(data));
            alert('Данные бюджета сохранены!');
        }

        // Функция загрузки данных бюджета
        function loadBudgetData(projectName) {
            const savedData = localStorage.getItem(`budgetData_${projectName}`);
            if (savedData) {
                const data = JSON.parse(savedData);
                const inputs = document.querySelectorAll('#budgetModal input');
                
                inputs.forEach((input, index) => {
                    if (data[`field_${index}`]) {
                        input.value = data[`field_${index}`];
                    }
                });
                
                alert('Данные бюджета загружены!');
            } else {
                alert('Сохраненных данных не найдено!');
            }
        }

        // Функция обновления статистики
        function updateStats(status) {
            const projectCards = document.querySelectorAll('.project-card');
            let activeCount = 0;
            let completedCount = 0;
            let planningCount = 0;
            let savedProjectsCount = 0;
            
            projectCards.forEach(card => {
                const cardStatus = card.getAttribute('data-status');
                const isSaved = card.getAttribute('data-saved') === 'true';
                
                if (isSaved) savedProjectsCount++;
                
                if (cardStatus === 'active') activeCount++;
                if (cardStatus === 'completed') completedCount++;
                if (cardStatus === 'planning') planningCount++;
            });
            
            // Обновляем счетчики в статистике
            const statValues = document.querySelectorAll('.stat-value');
            if (statValues.length >= 4) {
                statValues[0].textContent = activeCount; // Активных проекта
                statValues[1].textContent = completedCount; // Завершенных
                statValues[2].textContent = planningCount; // Планирование
                statValues[3].textContent = '0'; // Просроченных
            }
            
            // Показываем количество сохраненных проектов в консоли
            console.log(`Всего проектов: ${projectCards.length}, Сохраненных: ${savedProjectsCount}, Планирование: ${planningCount}`);
        }

        // Функция сохранения проекта в localStorage
        function saveProjectToStorage(projectData) {
            try {
                // Получаем существующие проекты
                const existingProjects = JSON.parse(localStorage.getItem('userProjects') || '[]');
                
                // Добавляем новый проект
                existingProjects.push(projectData);
                
                // Сохраняем обратно в localStorage
                localStorage.setItem('userProjects', JSON.stringify(existingProjects));
                
                console.log('Проект сохранен в localStorage:', projectData);
            } catch (error) {
                console.error('Ошибка при сохранении проекта:', error);
                alert('Ошибка при сохранении проекта. Попробуйте еще раз.');
            }
        }

        // Функция загрузки проектов из localStorage
        function loadProjectsFromStorage() {
            try {
                const savedProjects = JSON.parse(localStorage.getItem('userProjects') || '[]');
                return savedProjects;
            } catch (error) {
                console.error('Ошибка при загрузке проектов:', error);
                return [];
            }
        }

        // Функция отображения сохраненных проектов
        function displaySavedProjects() {
            const savedProjects = loadProjectsFromStorage();
            const projectsGrid = document.querySelector('.projects-grid');
            
            // Очищаем только динамически созданные проекты (с data-saved="true")
            const existingCards = projectsGrid.querySelectorAll('.project-card');
            existingCards.forEach(card => {
                if (card.getAttribute('data-saved') === 'true') {
                    card.remove();
                }
            });
            
            // Добавляем сохраненные проекты (только не статичные)
            savedProjects.forEach(projectData => {
                // Пропускаем статичные проекты, они уже есть в HTML
                if (projectData.isStatic) {
                    return;
                }
                
                // Убираем флаг isNew для загруженных проектов
                if (projectData.isNew) {
                    projectData.isNew = false;
                }
                const projectCard = createProjectCard(projectData);
                projectCard.setAttribute('data-saved', 'true');
                projectCard.setAttribute('data-project-id', projectData.id);
                projectsGrid.insertBefore(projectCard, projectsGrid.firstChild);
            });
            
            // Обновляем статистику
            updateStats('active');
        }


        // Резервная функция для создания модального окна динамически
        function createDynamicModal() {
            console.log('Создаем модальное окно динамически');
            
            // Удаляем существующее модальное окно, если есть
            const existingModal = document.getElementById('newProjectModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modalHTML = `
                <div id="newProjectModal" style="
                    display: flex !important;
                    position: fixed !important;
                    z-index: 10000 !important;
                    left: 0 !important;
                    top: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    background-color: rgba(0, 0, 0, 0.6) !important;
                    align-items: center !important;
                    justify-content: center !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                ">
                    <div style="
                        background: white !important;
                        border-radius: 12px !important;
                        width: 90% !important;
                        max-width: 600px !important;
                        max-height: 90vh !important;
                        overflow-y: auto !important;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3) !important;
                    ">
                        <div style="
                            display: flex !important;
                            justify-content: space-between !important;
                            align-items: center !important;
                            padding: 20px 30px !important;
                            border-bottom: 1px solid #e5e7eb !important;
                        ">
                            <h2 style="margin: 0 !important; font-size: 20px !important; font-weight: 600 !important;">Создать новый проект</h2>
                            <button onclick="closeNewProjectModal()" style="
                                background: none !important;
                                border: none !important;
                                font-size: 24px !important;
                                cursor: pointer !important;
                                color: #666 !important;
                            ">&times;</button>
                        </div>
                        <form id="newProjectForm" style="padding: 20px 30px !important;">
                            <div style="margin-bottom: 20px !important;">
                                <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Название проекта *</label>
                                <input type="text" id="projectName" name="projectName" required style="
                                    width: 100% !important;
                                    padding: 12px !important;
                                    border: 1px solid #d1d5db !important;
                                    border-radius: 6px !important;
                                    font-size: 14px !important;
                                    box-sizing: border-box !important;
                                " placeholder="Введите название проекта">
                            </div>
                            
                            <div style="margin-bottom: 20px !important;">
                                <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Описание проекта *</label>
                                <textarea id="projectDescription" name="projectDescription" required style="
                                    width: 100% !important;
                                    padding: 12px !important;
                                    border: 1px solid #d1d5db !important;
                                    border-radius: 6px !important;
                                    font-size: 14px !important;
                                    height: 100px !important;
                                    resize: vertical !important;
                                    box-sizing: border-box !important;
                                " placeholder="Опишите проект"></textarea>
                            </div>
                            
                            <div style="display: flex !important; gap: 15px !important; margin-bottom: 20px !important;">
                                <div style="flex: 1 !important;">
                                    <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Статус проекта</label>
                                    <select id="projectStatus" name="projectStatus" style="
                                        width: 100% !important;
                                        padding: 12px !important;
                                        border: 1px solid #d1d5db !important;
                                        border-radius: 6px !important;
                                        font-size: 14px !important;
                                        box-sizing: border-box !important;
                                    ">
                                        <option value="planning">Планирование</option>
                                        <option value="active">В работе</option>
                                        <option value="completed">Завершено</option>
                                    </select>
                                </div>
                                
                                <div style="flex: 1 !important;">
                                    <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Прогресс (%) *</label>
                                    <input type="number" id="projectProgress" name="projectProgress" min="0" max="100" required style="
                                        width: 100% !important;
                                        padding: 12px !important;
                                        border: 1px solid #d1d5db !important;
                                        border-radius: 6px !important;
                                        font-size: 14px !important;
                                        box-sizing: border-box !important;
                                    " placeholder="0">
                                </div>
                            </div>
                            
                            <div style="display: flex !important; gap: 15px !important; margin-bottom: 20px !important;">
                                <div style="flex: 1 !important;">
                                    <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Бюджет (M ₸) *</label>
                                    <input type="number" id="projectBudget" name="projectBudget" min="0" step="0.1" required style="
                                        width: 100% !important;
                                        padding: 12px !important;
                                        border: 1px solid #d1d5db !important;
                                        border-radius: 6px !important;
                                        font-size: 14px !important;
                                        box-sizing: border-box !important;
                                    " placeholder="1.0">
                                </div>
                                
                                <div style="flex: 1 !important;">
                                    <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Срок (месяцы)</label>
                                    <input type="number" id="projectDuration" name="projectDuration" min="1" style="
                                        width: 100% !important;
                                        padding: 12px !important;
                                        border: 1px solid #d1d5db !important;
                                        border-radius: 6px !important;
                                        font-size: 14px !important;
                                        box-sizing: border-box !important;
                                    " placeholder="12">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 30px !important;">
                                <label style="display: block !important; margin-bottom: 8px !important; font-weight: 600 !important;">Цвет проекта</label>
                                <select id="projectColor" name="projectColor" style="
                                    width: 100% !important;
                                    padding: 12px !important;
                                    border: 1px solid #d1d5db !important;
                                    border-radius: 6px !important;
                                    font-size: 14px !important;
                                    box-sizing: border-box !important;
                                ">
                                    <option value="green">Зеленый</option>
                                    <option value="orange">Оранжевый</option>
                                    <option value="blue">Синий</option>
                                </select>
                            </div>
                            
                            <div style="display: flex !important; justify-content: flex-end !important; gap: 10px !important;">
                                <button type="button" onclick="closeNewProjectModal()" style="
                                    background: #6b7280 !important;
                                    color: white !important;
                                    border: none !important;
                                    padding: 12px 24px !important;
                                    border-radius: 6px !important;
                                    cursor: pointer !important;
                                    font-size: 14px !important;
                                ">Отмена</button>
                                <button type="button" onclick="createNewProject()" style="
                                    background: #70B8B8 !important;
                                    color: white !important;
                                    border: none !important;
                                    padding: 12px 24px !important;
                                    border-radius: 6px !important;
                                    cursor: pointer !important;
                                    font-size: 14px !important;
                                ">Создать проект</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            console.log('Динамическое модальное окно создано');
        }

        function createNewProject() {
            const form = document.getElementById('newProjectForm');
            const formData = new FormData(form);
            
            // Получаем данные из формы
            const projectName = formData.get('projectName');
            const projectDescription = formData.get('projectDescription');
            const projectStatus = formData.get('projectStatus');
            const projectProgress = formData.get('projectProgress');
            const projectBudget = formData.get('projectBudget');
            const projectDuration = formData.get('projectDuration');
            const projectColor = formData.get('projectColor');
            
            // Получаем PDF файлы
            const charterPdf = formData.get('charterPdf');
            const schedulePdf = formData.get('schedulePdf');
            const budgetPdf = formData.get('budgetPdf');
            const equipmentPdf = formData.get('equipmentPdf');
            const constructionPdf = formData.get('constructionPdf');
            const designPdf = formData.get('designPdf');
            
            // Валидация
            if (!projectName || !projectDescription || !projectProgress || !projectBudget) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }
            
            // Создаем объект проекта для сохранения
            const projectData = {
                id: Date.now(), // Уникальный ID
                name: projectName,
                description: projectDescription,
                status: projectStatus,
                progress: parseInt(projectProgress),
                budget: parseFloat(projectBudget),
                duration: parseInt(projectDuration) || 12,
                color: projectColor,
                createdAt: new Date().toISOString(),
                isNew: true, // Флаг для новых проектов
                pdfFiles: {
                    charter: charterPdf ? charterPdf.name : null,
                    schedule: schedulePdf ? schedulePdf.name : null,
                    budget: budgetPdf ? budgetPdf.name : null,
                    equipment: equipmentPdf ? equipmentPdf.name : null,
                    construction: constructionPdf ? constructionPdf.name : null,
                    design: designPdf ? designPdf.name : null
                }
            };
            
            // Сохраняем проект в localStorage
            saveProjectToStorage(projectData);
            
            // Создаем новую карточку проекта
            const projectsGrid = document.querySelector('.projects-grid');
            const newProjectCard = createProjectCard(projectData);
            newProjectCard.setAttribute('data-saved', 'true');
            newProjectCard.setAttribute('data-project-id', projectData.id);
            
            // Добавляем карточку в начало списка
            projectsGrid.insertBefore(newProjectCard, projectsGrid.firstChild);
            
            // Обновляем статистику
            updateStats(projectStatus);
            
            // Закрываем модальное окно
            closeNewProjectModal();
            
            // Показываем уведомление
            alert('Проект успешно создан и сохранен!');
        }

        function createProjectCard(projectData) {
            const card = document.createElement('div');
            card.className = 'project-card';
            card.setAttribute('data-status', projectData.status);
            if (projectData.id) {
                card.setAttribute('data-project-id', projectData.id);
            }
            
            // Определяем цвет точки
            const colorClass = projectData.color === 'green' ? 'green' : 
                              projectData.color === 'orange' ? 'orange' : 'blue';
            
            // Определяем класс прогресса
            const progressClass = projectData.progress >= 100 ? 'progress-blue' : 
                                 projectData.progress >= 50 ? 'progress-green' : 'progress-orange';
            
            card.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                    <div class="project-dot ${colorClass}" style="margin-right: 12px;"></div>
                    <h3>${projectData.name}</h3>
                    ${projectData.id ? `<button class="delete-project-btn" onclick="deleteProject(${projectData.id})" style="margin-left: auto; background: #ef4444; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 12px; cursor: pointer;">×</button>` : ''}
                </div>
                <p>${projectData.description}</p>
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #666; font-size: 14px;">Прогресс</span>
                        <span style="color: #333; font-weight: 600;">${projectData.progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${progressClass}" style="width: ${projectData.progress}%;"></div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="color: #666; font-size: 14px;">
                        <div>Бюджет: ₸${projectData.budget}M</div>
                        <div>Срок: ${projectData.duration} мес.</div>
                        ${projectData.createdAt ? `<div style="font-size: 12px; color: #999;">Создан: ${new Date(projectData.createdAt).toLocaleDateString()}</div>` : ''}
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="status-controls" style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 12px; color: #666;">Статус:</span>
                            <select class="status-select" onchange="changeProjectStatus(${projectData.id || 'temp'}, this.value)" style="padding: 4px 8px; border: 1px solid #e5e5e7; border-radius: 4px; background: white; color: #333; font-size: 12px; min-width: 100px;">
                                <option value="planning" ${projectData.status === 'planning' ? 'selected' : ''}>Планирование</option>
                                <option value="active" ${projectData.status === 'active' ? 'selected' : ''}>В работе</option>
                                <option value="completed" ${projectData.status === 'completed' ? 'selected' : ''}>Завершено</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            
            // Добавляем обработчик клика для перехода к детальной странице
            card.onclick = function(e) {
                if (!e.target.classList.contains('delete-project-btn') && 
                    !e.target.classList.contains('status-select') &&
                    !e.target.closest('.status-controls')) {
                    // Создаем временную страницу проекта
                    createProjectDetailPage(projectData);
                }
            };
            
            return card;
        }

        // Функция изменения статуса проекта
        function changeProjectStatus(projectId, newStatus) {
            try {
                // Если это временный ID, не сохраняем в localStorage
                if (projectId === 'temp') {
                    console.log('Временный проект - статус не сохраняется');
                    return;
                }
                
                // Обновляем в localStorage
                const savedProjects = loadProjectsFromStorage();
                const projectIndex = savedProjects.findIndex(project => project.id === projectId);
                
                if (projectIndex !== -1) {
                    savedProjects[projectIndex].status = newStatus;
                    localStorage.setItem('savedProjects', JSON.stringify(savedProjects));
                }
                
                // Обновляем атрибут data-status в DOM (работает для всех проектов)
                const projectCard = document.querySelector(`[data-project-id="${projectId}"]`) || 
                                 document.querySelector(`[onclick*="${projectId}"]`) ||
                                 document.querySelector(`[onclick*="'${projectId}'"]`);
                
                if (projectCard) {
                    projectCard.setAttribute('data-status', newStatus);
                    
                    // Обновляем цвет точки в зависимости от статуса
                    const projectDot = projectCard.querySelector('.project-dot');
                    if (projectDot) {
                        projectDot.className = 'project-dot';
                        if (newStatus === 'planning') {
                            projectDot.classList.add('blue');
                        } else if (newStatus === 'active') {
                            projectDot.classList.add('green');
                        } else if (newStatus === 'completed') {
                            projectDot.classList.add('orange');
                        }
                    }
                    
                    // Обновляем select в DOM, чтобы он показывал новый статус
                    const statusSelect = projectCard.querySelector('.status-select');
                    if (statusSelect) {
                        statusSelect.value = newStatus;
                    }
                }
                
                // Обновляем статистику
                updateStats('active');
                
                console.log(`Статус проекта изменен на: ${newStatus}`);
            } catch (error) {
                console.error('Ошибка при изменении статуса проекта:', error);
                alert('Ошибка при изменении статуса проекта. Попробуйте еще раз.');
            }
        }


        // Функция удаления проекта
        function deleteProject(projectId) {
            if (confirm('Вы уверены, что хотите удалить этот проект?')) {
                try {
                    // Получаем сохраненные проекты
                    const savedProjects = loadProjectsFromStorage();
                    
                    // Фильтруем проекты, исключая удаляемый
                    const updatedProjects = savedProjects.filter(project => project.id !== projectId);
                    
                    // Сохраняем обновленный список
                    localStorage.setItem('userProjects', JSON.stringify(updatedProjects));
                    
                    // Удаляем карточку из DOM
                    const projectCard = document.querySelector(`[data-project-id="${projectId}"]`);
                    if (projectCard) {
                        projectCard.remove();
                    }
                    
                    // Обновляем статистику
                    updateStats('active');
                    
                    alert('Проект успешно удален!');
                } catch (error) {
                    console.error('Ошибка при удалении проекта:', error);
                    alert('Ошибка при удалении проекта. Попробуйте еще раз.');
                }
            }
        }

        function createProjectDetailPage(projectData) {
            // Перенаправляем на страницу проекта
            window.location.href = `project-detail.html?id=${projectData.id}`;
        }

        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modal = document.getElementById('newProjectModal');
            if (event.target === modal) {
                closeNewProjectModal();
            }
        }

        // Закрытие модального окна по клавише Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('newProjectModal');
                if (modal.style.display === 'block') {
                    closeNewProjectModal();
                }
            }
        });

        // Обработчик изменения размера окна для пересчета прокрутки
        window.addEventListener('resize', function() {
            const modal = document.getElementById('newProjectModal');
            if (modal && modal.style.display === 'block') {
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    // Пересчитываем высоту при изменении размера окна
                    modalBody.style.maxHeight = 'calc(90vh - 140px)';
                    
                    // Проверяем, нужна ли прокрутка
                    if (modalBody.scrollHeight > modalBody.clientHeight) {
                        modalBody.style.overflowY = 'scroll';
                    } else {
                        modalBody.style.overflowY = 'auto';
                    }
                }
            }
        });

        // Улучшенная прокрутка на мобильных устройствах
        function preventBodyScroll() {
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
        }

        function restoreBodyScroll() {
            document.body.style.position = '';
            document.body.style.width = '';
        }

        // Обновляем функции открытия/закрытия модального окна
        function openNewProjectModal() {
            console.log('openNewProjectModal вызвана');
            const modal = document.getElementById('newProjectModal');
            
            if (!modal) {
                console.error('Модальное окно newProjectModal не найдено!');
                alert('Ошибка: Модальное окно не найдено!');
                return;
            }
            
            console.log('Модальное окно найдено:', modal);
            console.log('Текущие стили модального окна:', {
                display: modal.style.display,
                visibility: modal.style.visibility,
                opacity: modal.style.opacity,
                zIndex: modal.style.zIndex,
                position: modal.style.position
            });
            
            // Принудительно устанавливаем стили
            modal.style.display = 'flex';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            modal.style.zIndex = '10000';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            // Дополнительная проверка через 100ms
            setTimeout(() => {
                console.log('Проверка через 100ms:', {
                    display: modal.style.display,
                    visibility: modal.style.visibility,
                    opacity: modal.style.opacity,
                    zIndex: modal.style.zIndex,
                    computedStyle: window.getComputedStyle(modal).display
                });
                
                if (window.getComputedStyle(modal).display === 'none') {
                    console.warn('Модальное окно все еще скрыто, используем резервную функцию');
                    createDynamicModal();
                }
            }, 100);
            
            preventBodyScroll();
            
            // Плавное появление модального окна
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.classList.add('show');
                
                // Принудительно активируем прокрутку в modal-body
                const modalBody = modal.querySelector('.modal-body');
                if (modalBody) {
                    modalBody.style.overflowY = 'auto';
                    modalBody.style.maxHeight = 'calc(90vh - 140px)';
                    
                // Проверяем, нужна ли прокрутка
                if (modalBody.scrollHeight > modalBody.clientHeight) {
                    modalBody.style.overflowY = 'scroll';
                }
                
                console.log('Модальное окно открыто');
            }
        }, 10);
        }

        function closeNewProjectModal() {
            console.log('closeNewProjectModal вызвана');
            const modal = document.getElementById('newProjectModal');
            
            if (!modal) {
                console.warn('Модальное окно не найдено для закрытия');
                return;
            }
            
            console.log('Закрываем модальное окно');
            
            // Для динамически созданного модального окна просто удаляем его
            if (modal.style.position === 'fixed' && modal.style.zIndex === '10000') {
                modal.remove();
                restoreBodyScroll();
                console.log('Динамическое модальное окно удалено');
                return;
            }
            
            // Для обычного модального окна используем анимацию
            modal.style.opacity = '0';
            modal.classList.remove('show');
            
            // Закрываем с анимацией
            setTimeout(() => {
                modal.style.display = 'none';
                restoreBodyScroll();
                // Очищаем форму
                const form = document.getElementById('newProjectForm');
                if (form) {
                    form.reset();
                }
                console.log('Обычное модальное окно закрыто');
            }, 300);
        }

        // AI Chat Functions
        let isChatOpen = false;
        let isMinimized = false;

        function toggleAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            const floatButton = document.querySelector('.ai-float-button');
            
            if (isChatOpen) {
                closeAIChat();
            } else {
                chatWindow.classList.add('show');
                floatButton.style.display = 'none';
                isChatOpen = true;
                isMinimized = false;
            }
        }

        function closeAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            const floatButton = document.querySelector('.ai-float-button');
            
            chatWindow.classList.remove('show');
            chatWindow.classList.remove('minimized');
            setTimeout(() => {
                floatButton.style.display = 'flex';
            }, 300);
            isChatOpen = false;
            isMinimized = false;
        }

        function minimizeAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            chatWindow.classList.toggle('minimized');
            isMinimized = !isMinimized;
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Добавляем сообщение пользователя
            addMessageToChat(message, 'user');
            input.value = '';

            // Имитируем ответ AI
            setTimeout(() => {
                const aiResponse = getAIResponse(message);
                addMessageToChat(aiResponse, 'ai');
            }, 1000);
        }

        function sendSuggestion(suggestion) {
            const input = document.getElementById('aiChatInput');
            input.value = suggestion;
            sendAIMessage();
        }

        function handleAIEnter(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        function addMessageToChat(message, sender) {
            const chatBody = document.getElementById('aiChatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message-container ${sender}`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="ai-message user-message">
                        <div class="ai-message-text">${message}</div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="ai-avatar">🤖</div>
                    <div class="ai-message">
                        <div class="ai-message-text">${message}</div>
                    </div>
                `;
            }
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function getAIResponse(message) {
            const responses = {
                'показать активные задачи': 'Вот ваши активные задачи:\n• Завершить проект "ЖК Прогресс"\n• Подготовить отчет по "Астана Plaza"\n• Провести совещание с командой',
                'статус проектов': 'Статус ваших проектов:\n• ЖК Прогресс: 75% завершен\n• Астана Plaza: 25% завершен\n• Офисный центр: В планировании',
                'финансовый отчет': 'Финансовый отчет:\n• Общий бюджет: ₸2.5M\n• Потрачено: ₸1.8M\n• Остаток: ₸0.7M',
                'привет': 'Привет! Я AI-ассистент PRIME360. Чем могу помочь?',
                'помощь': 'Я могу помочь с:\n• Просмотром статуса проектов\n• Финансовой отчетностью\n• Управлением задачами\n• Аналитикой данных'
            };
            
            const lowerMessage = message.toLowerCase();
            for (const [key, response] of Object.entries(responses)) {
                if (lowerMessage.includes(key)) {
                    return response;
                }
            }
            
            return 'Извините, я не понял ваш вопрос. Попробуйте спросить о статусе проектов, задачах или финансах.';
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <img src="img/icon prime360.png" alt="PRIME360.AI" width="32" height="32">
                </div>
                <div class="logo-text">PRIME360.AI</div>
            </div>
            
            <a href="index.html" class="menu-item">
                <span class="menu-icon">🏠</span>
                Главная
            </a>
            <a href="projects.html" class="menu-item active">
                <span class="menu-icon">
                    <img src="img/svg/insightschart.svg" alt="Проекты" width="20" height="20">
                </span>
                Проекты
            </a>
            <a href="#" class="menu-item" onclick="toggleAIChat(); return false;">
                <span class="menu-icon">🤖</span>
                AI-ассистент
            </a>
            <a href="documents.html" class="menu-item">
                <span class="menu-icon">📚</span>
                Библиотека
            </a>
            <a href="meetings.html" class="menu-item">
                <span class="menu-icon">💬</span>
                Совещания
            </a>
            <a href="messenger.html" class="menu-item">
                <span class="menu-icon">📱</span>
                Мессенджер
            </a>

            <div class="ai-assistant">
                <div class="ai-icon">🤖</div>
                <div class="ai-title">AI-ассистент</div>
                <div class="ai-description">
                    Нет новых рекомендаций пока вы можете задать любые вопросы по работе подрядчиков системе данным
                </div>
                <button class="ai-button">Написать чату</button>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div></div>
                <div class="search-container">
                    <input type="text" id="global-search" class="search-input" placeholder="Поиск">
                    <span class="search-icon">
                        <img src="img/svg/eye.svg" alt="Поиск" width="16" height="16">
                    </span>
                </div>
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name" id="userName">Айгун Ахметова</div>
                        <div class="user-role" id="userRole">Админ</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">А</div>
                    <button onclick="logout()" class="logout-button">Выйти</button>
                </div>
            </div>

            <!-- Projects Page Content -->
            <div class="content-header">
                <div class="content-title">
                    <div class="title-left">
                        <div class="title-text">Проекты</div>
                    </div>
                    <button class="invite-button" onclick="createDynamicModal()">
                        <span>+</span>
                        Новый проект
                    </button>
                </div>
                <div class="project-tabs">
                    <button class="tab-button active" onclick="filterProjects('active')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" fill="#10b981" stroke="#10b981" stroke-width="2"/>
                            <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Действующие
                    </button>
                    <button class="tab-button" onclick="filterProjects('completed')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L4 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-8-4z" fill="#16a34a"/>
                            <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Завершенные
                    </button>
                </div>
            </div>

            <div class="content-body">
                <div class="projects-grid">
                    <div class="project-card" data-status="active" onclick="if (!event.target.closest('.budget-btn')) window.location.href='project-zhk-progress.html'">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div class="project-dot green" style="margin-right: 12px;"></div>
                            <h3>ЖК Прогресс</h3>
                        </div>
                        <p>Строительство жилого комплекса в центре города</p>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Прогресс</span>
                                <span style="color: #333; font-weight: 600;">85%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-green" style="width: 85%;"></div>
                            </div>
                        </div>
                        <div class="project-footer">
                            <div class="project-deadline">Срок: 15.12.2024</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="project-status status-active">В работе</div>
                            </div>
                        </div>
                    </div>

                    <div class="project-card" data-status="active" onclick="window.location.href='project-astana-plaza.html'">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div class="project-dot orange" style="margin-right: 12px;"></div>
                            <h3>Астана Plaza</h3>
                        </div>
                        <p>Торгово-развлекательный комплекс</p>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Прогресс</span>
                                <span style="color: #333; font-weight: 600;">60%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-orange" style="width: 60%;"></div>
                            </div>
                        </div>
                        <div class="project-footer">
                            <div class="project-deadline">Срок: 20.03.2025</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="project-status status-active">В работе</div>
                            </div>
                        </div>
                    </div>

                    <div class="project-card" data-status="completed" onclick="window.location.href='project-detail.html'">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div class="project-dot blue" style="margin-right: 12px;"></div>
                            <h3>Солнечная Электростанция</h3>
                        </div>
                        <p>Строительство солнечной электростанции мощностью 10 МВт</p>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Прогресс</span>
                                <span style="color: #333; font-weight: 600;">100%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-blue" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div class="project-footer">
                            <div class="project-deadline">Срок: 15.01.2025</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="project-status status-completed">Завершен</div>
                            </div>
                        </div>
                    </div>

                    <div class="project-card" data-status="active" onclick="window.location.href='project-office-center.html'">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div class="project-dot blue" style="margin-right: 12px;"></div>
                            <h3>Офисный центр</h3>
                        </div>
                        <p>Многоэтажный офисный комплекс</p>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #666; font-size: 14px;">Прогресс</span>
                                <span style="color: #333; font-weight: 600;">25%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-blue" style="width: 25%;"></div>
                            </div>
                        </div>
                        <div class="project-footer">
                            <div class="project-deadline">Срок: 10.06.2025</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="project-status status-planning">Планирование</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3 class="stats-title">Статистика проектов</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value stat-green">4</div>
                            <div class="stat-label">Активных проекта</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value stat-blue">2</div>
                            <div class="stat-label">Завершенных</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value stat-orange">1</div>
                            <div class="stat-label">Планирование</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value stat-red">0</div>
                            <div class="stat-label">Просроченных</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal для создания нового проекта -->
    <div id="newProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Создать новый проект</h2>
                <button class="close" onclick="closeNewProjectModal()">&times;</button>
            </div>
            <form id="newProjectForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="projectName">Название проекта *</label>
                        <input type="text" id="projectName" name="projectName" class="form-input" placeholder="Введите название проекта" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="projectDescription">Описание проекта *</label>
                        <textarea id="projectDescription" name="projectDescription" class="form-textarea" placeholder="Опишите проект" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="projectStatus">Статус проекта</label>
                            <select id="projectStatus" name="projectStatus" class="form-select">
                                <option value="planning">Планирование</option>
                                <option value="active">В работе</option>
                                <option value="completed">Завершено</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="projectProgress">Прогресс (%) *</label>
                            <input type="number" id="projectProgress" name="projectProgress" class="form-input" min="0" max="100" placeholder="0" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="projectBudget">Бюджет (M ₸) *</label>
                            <input type="number" id="projectBudget" name="projectBudget" class="form-input" min="0" step="0.1" placeholder="1.0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="projectDuration">Срок (месяцы)</label>
                            <input type="number" id="projectDuration" name="projectDuration" class="form-input" min="1" placeholder="12">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="projectColor">Цвет проекта</label>
                        <select id="projectColor" name="projectColor" class="form-select">
                            <option value="green">Зеленый</option>
                            <option value="orange">Оранжевый</option>
                            <option value="blue">Синий</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">PDF документы проекта</label>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px dashed #e5e5e7;">
                            <div class="pdf-upload-section">
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="charterPdf" style="font-size: 14px; margin-bottom: 5px;">Устав (Основные документы проекта)</label>
                                    <input type="file" id="charterPdf" name="charterPdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                                
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="schedulePdf" style="font-size: 14px; margin-bottom: 5px;">График проекта (план/факт)</label>
                                    <input type="file" id="schedulePdf" name="schedulePdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                                
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="budgetPdf" style="font-size: 14px; margin-bottom: 5px;">Бюджет проекта</label>
                                    <input type="file" id="budgetPdf" name="budgetPdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                                
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="equipmentPdf" style="font-size: 14px; margin-bottom: 5px;">Основное и вспомогательное оборудование</label>
                                    <input type="file" id="equipmentPdf" name="equipmentPdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                                
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="constructionPdf" style="font-size: 14px; margin-bottom: 5px;">Строительно-монтажные работы</label>
                                    <input type="file" id="constructionPdf" name="constructionPdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                                
                                <div class="pdf-upload-item">
                                    <label class="form-label" for="designPdf" style="font-size: 14px; margin-bottom: 5px;">Проектно-изыскательские работы</label>
                                    <input type="file" id="designPdf" name="designPdf" accept=".pdf" class="form-input" style="padding: 8px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeNewProjectModal()">Отмена</button>
                    <button type="button" class="btn btn-primary" onclick="createNewProject()">Создать проект</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating AI Assistant Button -->
    <button class="ai-float-button" onclick="toggleAIChat()" title="AI Ассистент">
        <span class="ai-float-icon">🤖</span>
        <span class="ai-pulse"></span>
    </button>

    <!-- AI Chat Window -->
    <div id="aiChatWindow" class="ai-chat-window">
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                <span class="ai-chat-icon">🤖</span>
                <div>
                    <div class="ai-chat-name">AI Ассистент PRIME360</div>
                    <div class="ai-chat-status">
                        <span class="status-dot online"></span>
                        В сети
                    </div>
                </div>
            </div>
            <div class="ai-chat-actions">
                <button class="ai-action-btn" onclick="minimizeAIChat()" title="Свернуть">−</button>
                <button class="ai-action-btn" onclick="closeAIChat()" title="Закрыть">×</button>
            </div>
        </div>
        
        <div class="ai-chat-body" id="aiChatBody">
            <div class="ai-welcome-message">
                <div class="ai-avatar">🤖</div>
                <div class="ai-message">
                    <div class="ai-message-text">
                        Привет! Я AI-ассистент PRIME360. Чем могу помочь?
                        <div class="ai-suggestions">
                            <button class="suggestion-btn" onclick="sendSuggestion('Показать активные задачи')">
                                <img src="img/svg/insightschart.svg" alt="Задачи" width="16" height="16" style="vertical-align: middle; margin-right: 8px;"> Показать активные задачи
                            </button>
                            <button class="suggestion-btn" onclick="sendSuggestion('Статус проектов')">
                                <img src="img/svg/insightschart.svg" alt="Статус" width="16" height="16" style="vertical-align: middle; margin-right: 8px;"> Статус проектов
                            </button>
                            <button class="suggestion-btn" onclick="sendSuggestion('Финансовый отчет')">
                                <img src="img/svg/flash.svg" alt="Финансы" width="16" height="16" style="vertical-align: middle; margin-right: 8px;"> Финансовый отчет
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ai-chat-footer">
            <div class="ai-input-container">
                <button class="ai-attach-btn" title="Прикрепить файл">📎</button>
                <input type="text" 
                       id="aiChatInput" 
                       class="ai-input" 
                       placeholder="Введите сообщение..." 
                       onkeypress="handleAIEnter(event)">
                <button class="ai-send-btn" onclick="sendAIMessage()" title="Отправить">
                    <span class="send-icon">📤</span>
                </button>
            </div>
            <div class="ai-footer-info">
                <span class="ai-footer-text">AI может делать ошибки. Проверяйте важную информацию.</span>
            </div>
        </div>
    </div>
</body>
</html>
