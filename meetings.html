<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIME360.AI - –°–æ–≤–µ—â–∞–Ω–∏—è</title>
    <link rel="icon" type="image/png" href="img/icon prime360.png">
    <link rel="apple-touch-icon" href="img/icon prime360.png">
    <link rel="stylesheet" href="css/meetings.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/user-profile.js"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <img src="img/icon prime360.png" alt="PRIME360.AI" width="32" height="32">
                </div>
                <div class="logo-text">PRIME360.AI</div>
            </div>
            
            <a href="index.html" class="menu-item">
                <span class="menu-icon">üè†</span>
                –ì–ª–∞–≤–Ω–æ–µ
            </a>
            <a href="projects.html" class="menu-item">
                <span class="menu-icon">üìä</span>
                –ü—Ä–æ–µ–∫—Ç—ã
            </a>
            <a href="index.html" class="menu-item">
                <span class="menu-icon">ü§ñ</span>
                AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
            </a>
            <a href="documents.html" class="menu-item">
                <span class="menu-icon">üìö</span>
                –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞
            </a>
            <a href="meetings.html" class="menu-item active">
                <span class="menu-icon">üí¨</span>
                –°–æ–≤–µ—â–∞–Ω–∏—è
            </a>
            <a href="messenger.html" class="menu-item">
                <span class="menu-icon">üì±</span>
                –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
            </a>

        </div>

        <div class="main-content">
            <div class="header">
                <div></div>
                <div class="search-container">
                    <input type="text" id="global-search" class="search-input" placeholder="–ü–æ–∏—Å–∫">
                    <span class="search-icon">üîç</span>
                </div>
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name" id="userName">–ê–π–≥—É–Ω –ê—Ö–º–µ—Ç–æ–≤–∞</div>
                        <div class="user-role" id="userRole">–ê–¥–º–∏–Ω</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">–ê</div>
                    <button onclick="logout()" class="logout-button">–í—ã–π—Ç–∏</button>
                </div>
            </div>

            <!-- Meetings Page Content -->
            <div class="content-header">
                <div class="content-title">
                    <div class="title-left">
                        <div class="title-text">–°–æ–≤–µ—â–∞–Ω–∏—è</div>
                        </div>
                    <button class="protocol-button" onclick="openProtocolModal()">
                        <span>üìã</span>
                        –ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –∏—Ç–æ–≥–∞–º —Å–æ–≤–µ—â–∞–Ω–∏–π
                    </button>
                </div>
            </div>

            <div class="content-body">
                <!-- Calendar Container -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prevMonth" onclick="changeMonth(-1)">
                            <span>‚Äπ</span>
                        </button>
                        <div class="calendar-title">
                            <h2 id="currentMonth">–û–∫—Ç—è–±—Ä—å 2025</h2>
                        </div>
                        <button class="calendar-nav-btn" id="nextMonth" onclick="changeMonth(1)">
                            <span>‚Ä∫</span>
                        </button>
                    </div>
                    
                    <div class="calendar-weekdays">
                        <div class="weekday">–ü–ù</div>
                        <div class="weekday">–í–¢</div>
                        <div class="weekday">–°–†</div>
                        <div class="weekday">–ß–¢</div>
                        <div class="weekday">–ü–¢</div>
                        <div class="weekday">–°–ë</div>
                        <div class="weekday">–í–°</div>
                    </div>
                    
                    <div class="calendar-days" id="calendarDays">
                        <!-- Days will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Meeting Details Sidebar -->
                <div class="meeting-details-sidebar" id="meetingSidebar">
                    <div class="sidebar-header">
                        <h3 id="selectedDate">–°–æ–≤–µ—â–∞–Ω–∏—è</h3>
                        <button class="close-sidebar-btn" onclick="closeMeetingSidebar()">√ó</button>
                        </div>
                    <div class="sidebar-content" id="sidebarContent">
                        <p class="no-meetings">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–≤–µ—â–∞–Ω–∏–π</p>
                        </div>
                    <button class="add-meeting-btn" onclick="addNewMeeting()">
                        <span>‚ûï</span>
                        –î–æ–±–∞–≤–∏—Ç—å —Å–æ–≤–µ—â–∞–Ω–∏–µ
                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- Protocol Tasks Table Modal -->
    <div id="protocolTableModal" class="modal">
        <div class="modal-content protocol-table-modal-content">
            <div class="modal-header">
                <h2><span class="modal-icon">üìù</span> –§–æ—Ä–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á</h2>
                <button onclick="closeProtocolTableModal()" class="close-modal">&times;</button>
                        </div>
            
            <div class="modal-body protocol-table-body">
                <div class="protocol-table-header">
                    <h3 id="selectedProjectName">–ü—Ä–æ–µ–∫—Ç: </h3>
                    <div class="protocol-actions">
                        <button class="btn-secondary" onclick="openProtocolChartsModal()">
                            <span>üìä</span>
                            –ì—Ä–∞—Ñ–∏–∫–∏
                        </button>
                        <button class="btn-secondary" onclick="exportToExcel()">
                            <span>üì•</span>
                            –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                        </button>
                        <button class="btn-whatsapp" onclick="sendProtocolToWhatsApp()">
                            <span>üí¨</span>
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                        <button class="btn-primary" onclick="saveProtocolTasks()">
                            <span>üíæ</span>
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        </div>
                                </div>
                
                <div class="table-container">
                    <table class="protocol-table" id="protocolTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">‚Ññ</th>
                                <th style="width: 250px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</th>
                                <th style="width: 140px;">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏</th>
                                <th style="width: 140px;">–ü–ª–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th style="width: 140px;">–§–∞–∫—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
                                <th style="width: 150px;">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                                <th style="width: 120px;">–°—Ç–∞—Ç—É—Å</th>
                                <th style="width: 200px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</th>
                                <th style="width: 150px;">–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</th>
                            </tr>
                        </thead>
                        <tbody id="protocolTableBody">
                            <!-- Rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- Protocol Tasks Modal -->
    <div id="protocolModal" class="modal">
        <div class="modal-content protocol-modal-content">
            <div class="modal-header">
                <h2><span class="modal-icon">üìã</span> –ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –∏—Ç–æ–≥–∞–º —Å–æ–≤–µ—â–∞–Ω–∏–π</h2>
                <button onclick="closeProtocolModal()" class="close-modal">&times;</button>
                        </div>
            
            <div class="modal-body">
                <p class="modal-description">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ –∏—Ç–æ–≥–∞–º —Å–æ–≤–µ—â–∞–Ω–∏—è</p>
                
                <div class="projects-grid">
                    <div class="project-card" onclick="selectProjectForProtocol('–ñ–ö –ü—Ä–æ–≥—Ä–µ—Å—Å - –≠—Ç–∞–ø 2')">
                        <div class="project-card-header">
                            <div class="project-status status-active">–í —Ä–∞–±–æ—Ç–µ</div>
                            <div class="project-progress-mini">67%</div>
                        </div>
                        <h3 class="project-card-title">–ñ–ö –ü—Ä–æ–≥—Ä–µ—Å—Å - –≠—Ç–∞–ø 2</h3>
                        <p class="project-card-description">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∂–∏–ª–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞ "–ü—Ä–æ–≥—Ä–µ—Å—Å". –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–æ–≤ –ë –∏ –í</p>
                        <div class="project-card-tags">
                            <span class="project-tag">–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</span>
                            <span class="project-tag priority">–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                                </div>
                        <div class="project-card-footer">
                            <div class="project-team">
                                <div class="team-avatar">–ê</div>
                                <div class="team-avatar">–ë</div>
                                <div class="team-avatar">–í</div>
                                </div>
                            <div class="project-date">üìÖ –î–æ 31.12.2025</div>
                        </div>
                    </div>

                    <div class="project-card" onclick="selectProjectForProtocol('–ê—Å—Ç–∞–Ω–∞ Plaza')">
                        <div class="project-card-header">
                            <div class="project-status status-planning">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                            <div class="project-progress-mini">25%</div>
                        </div>
                        <h3 class="project-card-title">–ê—Å—Ç–∞–Ω–∞ Plaza</h3>
                        <p class="project-card-description">–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ –ê—Å—Ç–∞–Ω—ã —Å –æ—Ñ–∏—Å–Ω—ã–º–∏ –ø–æ–º–µ—â–µ–Ω–∏—è–º–∏</p>
                        <div class="project-card-tags">
                            <span class="project-tag">–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä</span>
                            <span class="project-tag">–ü—Ä–µ–º–∏—É–º</span>
                        </div>
                        <div class="project-card-footer">
                            <div class="project-team">
                                <div class="team-avatar">–ê</div>
                                <div class="team-avatar">–î</div>
                                </div>
                            <div class="project-date">üìÖ –î–æ 30.06.2026</div>
                                </div>
                            </div>

                    <div class="project-card" onclick="selectProjectForProtocol('–ö–ª–∏–µ–Ω—Ç –ê - –û—Ñ–∏—Å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å')">
                        <div class="project-card-header">
                            <div class="project-status status-active">–í —Ä–∞–±–æ—Ç–µ</div>
                            <div class="project-progress-mini">45%</div>
                        </div>
                        <h3 class="project-card-title">–ö–ª–∏–µ–Ω—Ç –ê - –û—Ñ–∏—Å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å</h3>
                        <p class="project-card-description">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ—Ñ–∏—Å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –∫–ª–∞—Å—Å–∞ –ê —Å –ø–æ–¥–∑–µ–º–Ω—ã–º –ø–∞—Ä–∫–∏–Ω–≥–æ–º</p>
                        <div class="project-card-tags">
                            <span class="project-tag">–û—Ñ–∏—Å—ã</span>
                            <span class="project-tag">–ö–ª–∞—Å—Å –ê</span>
                        </div>
                        <div class="project-card-footer">
                            <div class="project-team">
                                <div class="team-avatar">–ú</div>
                                <div class="team-avatar">–ö</div>
                            </div>
                            <div class="project-date">üìÖ –î–æ 15.09.2025</div>
                        </div>
                    </div>

                    <div class="project-card" onclick="selectProjectForProtocol('–ö–ª–∏–µ–Ω—Ç –ë - –ñ–∏–ª–æ–π –∫–≤–∞—Ä—Ç–∞–ª')">
                        <div class="project-card-header">
                            <div class="project-status status-completed">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            <div class="project-progress-mini">100%</div>
                        </div>
                        <h3 class="project-card-title">–ö–ª–∏–µ–Ω—Ç –ë - –ñ–∏–ª–æ–π –∫–≤–∞—Ä—Ç–∞–ª</h3>
                        <p class="project-card-description">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∂–∏–ª–æ–π –∫–≤–∞—Ä—Ç–∞–ª —Å —Ä–∞–∑–≤–∏—Ç–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π</p>
                        <div class="project-card-tags">
                            <span class="project-tag">–ñ–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å</span>
                            <span class="project-tag">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</span>
                        </div>
                        <div class="project-card-footer">
                            <div class="project-team">
                                <div class="team-avatar">–ü</div>
                                <div class="team-avatar">–°</div>
                                <div class="team-avatar">–¢</div>
                        </div>
                            <div class="project-date">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</div>
                        </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- Add Meeting Modal -->
    <div id="addMeetingModal" class="modal">
        <div class="modal-content meeting-modal-content">
            <div class="modal-header">
                <h2><span class="modal-icon">üìÖ</span> –ù–æ–≤–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ</h2>
                <button onclick="closeAddMeetingModal()" class="close-modal">&times;</button>
                        </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        <span class="label-icon">üìÖ</span>
                        –î–∞—Ç–∞
                    </label>
                    <input type="date" id="meetingDate" class="form-input" required>
                        </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-icon">üïê</span>
                        –í—Ä–µ–º—è
                    </label>
                    <input type="time" id="meetingTime" class="form-input" required>
                                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-icon">üìù</span>
                        –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–≤–µ—â–∞–Ω–∏—è
                    </label>
                    <input type="text" id="meetingTitle" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞" required>
                                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-icon">üë•</span>
                        –£—á–∞—Å—Ç–Ω–∏–∫–∏
                    </label>
                    <button type="button" class="invite-participants-btn" onclick="openParticipantsModal()">
                        <span>‚ûï</span>
                        –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
                    </button>
                    <div class="selected-participants" id="selectedParticipantsList">
                        <p class="no-participants-text">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>
                    </div>
                    <input type="hidden" id="meetingParticipants" value="">
                </div>

                <div class="form-group">
                    <label>
                        <span class="label-icon">üìã</span>
                        –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <textarea id="meetingDescription" class="form-input" rows="3" placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
                        </div>
                    </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddMeetingModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" onclick="saveMeeting()">
                    <span>üíæ</span>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
                                </div>
                            </div>
                        </div>

    <script>
        let currentDate = new Date();
        let selectedDateElement = null;
        let selectedDateForNewMeeting = null;
        
        // Load meetings from localStorage or use default data
        function loadMeetings() {
            const saved = localStorage.getItem('meetings');
            if (saved) {
                return JSON.parse(saved);
            }
            // Default sample meetings for demo
            return {
                '2025-10-01': [
                    { time: '10:00', title: '–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ', participants: 5, description: '–û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –Ω–∞ –Ω–µ–¥–µ–ª—é', conferenceLink: 'https://us05web.zoom.us/j/1234567890' },
                    { time: '14:00', title: '–û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞', participants: 3, description: '–ü—Ä–æ–µ–∫—Ç "–ê—Å—Ç–∞–Ω–∞ Plaza"', conferenceLink: 'https://us05web.zoom.us/j/1234567891' }
                ],
                '2025-10-05': [
                    { time: '11:00', title: '–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞', participants: 8, description: 'Sprint Planning', conferenceLink: 'https://us05web.zoom.us/j/1234567892' }
                ],
                '2025-10-10': [
                    { time: '09:00', title: '–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º', participants: 4, description: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', conferenceLink: 'https://meet.google.com/abc-defg-hij' },
                    { time: '15:00', title: '–†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞', participants: 6, description: '–û–±—Å—É–∂–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Å–ø—Ä–∏–Ω—Ç–∞', conferenceLink: 'https://us05web.zoom.us/j/1234567893' }
                ],
                '2025-10-15': [
                    { time: '13:00', title: '–î–µ–º–æ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è', participants: 10, description: '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π', conferenceLink: 'https://teams.microsoft.com/l/meetup-join/sample' }
                ]
            };
        }
        
        let meetings = loadMeetings();
        
        // Save meetings to localStorage
        function saveMeetingsToStorage() {
            localStorage.setItem('meetings', JSON.stringify(meetings));
        }
        
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month title
            const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                              '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Adjust for Monday start (0 = Sunday, 1 = Monday, etc.)
            const adjustedStartDay = startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1;
            
            // Clear calendar
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Add empty cells for days before month starts
            for (let i = 0; i < adjustedStartDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarDays.appendChild(emptyDay);
            }
            
            // Add days of the month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                const hasMeetings = meetings[dateStr];
                
                if (isToday) {
                    dayElement.classList.add('today');
                }
                
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    ${hasMeetings ? `<div class="meeting-indicator">${hasMeetings.length}</div>` : ''}
                `;
                
                dayElement.onclick = () => selectDate(dayElement, dateStr, day, month, year);
                calendarDays.appendChild(dayElement);
            }
        }
        
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }
        
        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }
        
        function selectDate(element, dateStr, day, month, year) {
            // Store selected date for new meeting
            selectedDateForNewMeeting = dateStr;
            
            // Remove previous selection
            if (selectedDateElement) {
                selectedDateElement.classList.remove('selected');
            }
            
            // Add selection to clicked day
            element.classList.add('selected');
            selectedDateElement = element;
            
            // Show sidebar
            const sidebar = document.getElementById('meetingSidebar');
            sidebar.classList.add('active');
            
            // Update sidebar content
            const monthNames = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
                              '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
            document.getElementById('selectedDate').textContent = `${day} ${monthNames[month]} ${year}`;
            
            const sidebarContent = document.getElementById('sidebarContent');
            const dayMeetings = meetings[dateStr];
            
            if (dayMeetings && dayMeetings.length > 0) {
                sidebarContent.innerHTML = dayMeetings.map((meeting, index) => `
                    <div class="meeting-item">
                        <div class="meeting-item-header">
                            <div class="meeting-time">üïê ${meeting.time}</div>
                            <div class="meeting-actions">
                                <button class="meeting-action-btn conference-btn" onclick="startConference('${dateStr}', ${index})" title="–ù–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é">
                                    üé•
                                </button>
                                <button class="meeting-action-btn edit-btn" onclick="editMeeting('${dateStr}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    ‚úèÔ∏è
                                </button>
                                <button class="meeting-action-btn delete-btn" onclick="deleteMeeting('${dateStr}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">
                                    üóëÔ∏è
                                </button>
                    </div>
                </div>
                        <div class="meeting-title">${meeting.title}</div>
                        <div class="meeting-participants">üë• ${meeting.participants} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        ${meeting.description ? `<div class="meeting-description">üìã ${meeting.description}</div>` : ''}
            </div>
                `).join('');
            } else {
                sidebarContent.innerHTML = '<p class="no-meetings">–ù–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–≤–µ—â–∞–Ω–∏–π</p>';
            }
        }
        
        function closeMeetingSidebar() {
            const sidebar = document.getElementById('meetingSidebar');
            sidebar.classList.remove('active');
            
            if (selectedDateElement) {
                selectedDateElement.classList.remove('selected');
                selectedDateElement = null;
            }
        }
        
        let editingMeetingDate = null;
        let editingMeetingIndex = null;
        
        function addNewMeeting() {
            editingMeetingDate = null;
            editingMeetingIndex = null;
            
            const modal = document.getElementById('addMeetingModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                const content = modal.querySelector('.modal-content');
                content.classList.add('show');
            }, 10);
            
            // Update modal title
            document.querySelector('#addMeetingModal .modal-header h2').innerHTML = '<span class="modal-icon">üìÖ</span> –ù–æ–≤–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ';
            
            // Set default date to selected date or today
            const today = new Date();
            const dateStr = selectedDateForNewMeeting || today.toISOString().split('T')[0];
            document.getElementById('meetingDate').value = dateStr;
            document.getElementById('meetingTime').value = '10:00';
        }
        
        function editMeeting(dateStr, index) {
            editingMeetingDate = dateStr;
            editingMeetingIndex = index;
            
            const meeting = meetings[dateStr][index];
            
            const modal = document.getElementById('addMeetingModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                const content = modal.querySelector('.modal-content');
                content.classList.add('show');
            }, 10);
            
            // Update modal title
            document.querySelector('#addMeetingModal .modal-header h2').innerHTML = '<span class="modal-icon">‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤–µ—â–∞–Ω–∏–µ';
            
            // Fill form with existing data
            document.getElementById('meetingDate').value = dateStr;
            document.getElementById('meetingTime').value = meeting.time;
            document.getElementById('meetingTitle').value = meeting.title;
            document.getElementById('meetingParticipants').value = meeting.participants;
            document.getElementById('meetingDescription').value = meeting.description || '';
        }
        
        function deleteMeeting(dateStr, index) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–≤–µ—â–∞–Ω–∏–µ?')) {
                // Remove meeting from array
                meetings[dateStr].splice(index, 1);
                
                // If no meetings left for this date, remove the date
                if (meetings[dateStr].length === 0) {
                    delete meetings[dateStr];
                }
                
                // Save to localStorage
                saveMeetingsToStorage();
                
                // Show success message
                showSuccessNotification('–°–æ–≤–µ—â–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!');
                
                // Refresh calendar
                renderCalendar();
                
                // Update sidebar if still on same date
                if (selectedDateElement) {
                    const [year, month, day] = dateStr.split('-').map(Number);
                    // Find the element for this date
                    const dayElements = document.querySelectorAll('.calendar-day:not(.empty)');
                    const dayElement = Array.from(dayElements).find(el => {
                        const dayNum = parseInt(el.querySelector('.day-number')?.textContent);
                        return dayNum === day;
                    });
                    if (dayElement) {
                        selectDate(dayElement, dateStr, day, month - 1, year);
                    }
                }
            }
        }
        
        function closeAddMeetingModal() {
            const modal = document.getElementById('addMeetingModal');
            const content = modal.querySelector('.modal-content');
            content.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
                // Clear form
                document.getElementById('meetingDate').value = '';
                document.getElementById('meetingTime').value = '';
                document.getElementById('meetingTitle').value = '';
                document.getElementById('meetingParticipants').value = '1';
                document.getElementById('meetingDescription').value = '';
            }, 300);
        }
        
        function saveMeeting() {
            const date = document.getElementById('meetingDate').value;
            const time = document.getElementById('meetingTime').value;
            const title = document.getElementById('meetingTitle').value;
            const participants = parseInt(document.getElementById('meetingParticipants').value);
            const description = document.getElementById('meetingDescription').value;
            
            if (!date || !time || !title) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            // Create meeting object
            const meeting = {
                time: time,
                title: title,
                participants: participants,
                description: description
            };
            
            // Check if editing existing meeting
            if (editingMeetingDate !== null && editingMeetingIndex !== null) {
                // Remove from old date if date changed
                if (editingMeetingDate !== date) {
                    meetings[editingMeetingDate].splice(editingMeetingIndex, 1);
                    if (meetings[editingMeetingDate].length === 0) {
                        delete meetings[editingMeetingDate];
                    }
                    
                    // Add to new date
                    if (!meetings[date]) {
                        meetings[date] = [];
                    }
                    meetings[date].push(meeting);
                } else {
                    // Update existing meeting
                    meetings[date][editingMeetingIndex] = meeting;
                }
                
                showSuccessNotification('–°–æ–≤–µ—â–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
                // Add new meeting
                if (!meetings[date]) {
                    meetings[date] = [];
                }
                meetings[date].push(meeting);
                
                showSuccessNotification('–°–æ–≤–µ—â–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            }
            
            // Sort meetings by time
            if (meetings[date]) {
                meetings[date].sort((a, b) => a.time.localeCompare(b.time));
            }
            
            // Save to localStorage
            saveMeetingsToStorage();
            
            // Close modal
            closeAddMeetingModal();
            
            // Refresh calendar
            renderCalendar();
            
            // If date is selected, update sidebar
            const [year, month, day] = date.split('-').map(Number);
            const dayElements = document.querySelectorAll('.calendar-day:not(.empty)');
            const dayElement = Array.from(dayElements).find(el => {
                const dayNum = parseInt(el.querySelector('.day-number')?.textContent);
                return dayNum === day;
            });
            if (dayElement) {
                selectDate(dayElement, date, day, month - 1, year);
            }
        }
        
        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = `
                <span class="success-icon">‚úì</span>
                ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // Protocol Modal Functions
        function openProtocolModal() {
            const modal = document.getElementById('protocolModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                const content = modal.querySelector('.modal-content');
                content.classList.add('show');
            }, 10);
        }
        
        function closeProtocolModal() {
            const modal = document.getElementById('protocolModal');
            const content = modal.querySelector('.modal-content');
            content.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        
        let currentProtocolProject = '';
        
        function selectProjectForProtocol(projectName) {
            currentProtocolProject = projectName;
            closeProtocolModal();
            openProtocolTableModal(projectName);
        }
        
        function openProtocolTableModal(projectName) {
            const modal = document.getElementById('protocolTableModal');
            document.getElementById('selectedProjectName').textContent = `–ü—Ä–æ–µ–∫—Ç: ${projectName}`;
            
            // Generate table rows
            generateProtocolTableRows();
            
            modal.style.display = 'flex';
            setTimeout(() => {
                const content = modal.querySelector('.modal-content');
                content.classList.add('show');
            }, 10);
        }
        
        function closeProtocolTableModal() {
            const modal = document.getElementById('protocolTableModal');
            const content = modal.querySelector('.modal-content');
            content.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        
        function generateProtocolTableRows() {
            const tbody = document.getElementById('protocolTableBody');
            tbody.innerHTML = '';
            
            for (let i = 1; i <= 29; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="row-number">${i}</td>
                    <td><input type="text" class="table-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"></td>
                    <td><input type="date" class="table-input"></td>
                    <td><input type="date" class="table-input"></td>
                    <td><input type="date" class="table-input"></td>
                    <td><input type="text" class="table-input" placeholder="–§–ò–û"></td>
                    <td>
                        <select class="table-select">
                            <option value="–í —Ä–∞–±–æ—Ç–µ">–í —Ä–∞–±–æ—Ç–µ</option>
                            <option value="–ó–∞–≤–µ—Ä—à–µ–Ω–æ">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                            <option value="–û—Ç–ª–æ–∂–µ–Ω–æ">–û—Ç–ª–æ–∂–µ–Ω–æ</option>
                            <option value="–û—Ç–º–µ–Ω–µ–Ω–æ">–û—Ç–º–µ–Ω–µ–Ω–æ</option>
                        </select>
                    </td>
                    <td><input type="text" class="table-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></td>
                    <td><input type="url" class="table-input" placeholder="https://"></td>
                `;
                tbody.appendChild(row);
            }
        }
        
        function saveProtocolTasks() {
            const rows = document.querySelectorAll('#protocolTableBody tr');
            const tasks = [];
            
            rows.forEach((row, index) => {
                const inputs = row.querySelectorAll('.table-input, .table-select');
                const task = {
                    number: index + 1,
                    name: inputs[0].value,
                    dateSet: inputs[1].value,
                    planDate: inputs[2].value,
                    factDate: inputs[3].value,
                    responsible: inputs[4].value,
                    status: inputs[5].value,
                    comments: inputs[6].value,
                    link: inputs[7].value
                };
                
                // Only save non-empty tasks
                if (task.name || task.responsible) {
                    tasks.push(task);
                }
            });
            
            // Save to localStorage
            const storageKey = `protocol_tasks_${currentProtocolProject.replace(/\s+/g, '_')}`;
            localStorage.setItem(storageKey, JSON.stringify(tasks));
            
            showSuccessNotification(`–ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "${currentProtocolProject}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!`);
        }
        
        function exportToExcel() {
            showSuccessNotification('–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
            // TODO: Implement Excel export functionality
        }
        
        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', renderCalendar);
        
        // Close modal on outside click
        window.onclick = function(event) {
            const addMeetingModal = document.getElementById('addMeetingModal');
            const protocolModal = document.getElementById('protocolModal');
            const protocolTableModal = document.getElementById('protocolTableModal');
            const participantsModal = document.getElementById('participantsModal');
            const protocolChartsModal = document.getElementById('protocolChartsModal');
            
            if (event.target === addMeetingModal) {
                closeAddMeetingModal();
            }
            if (event.target === protocolModal) {
                closeProtocolModal();
            }
            if (event.target === protocolTableModal) {
                closeProtocolTableModal();
            }
            if (event.target === participantsModal) {
                closeParticipantsModal();
            }
            if (event.target === protocolChartsModal) {
                closeProtocolChartsModal();
            }
        }

        // Participants Modal Functions
        let selectedParticipants = [];
        
        const availableUsers = [
            { id: 1, name: '–ê–π–≥—É–Ω –ê—Ö–º–µ—Ç–æ–≤–∞', position: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', avatar: '–ê–ê' },
            { id: 2, name: '–ù—É—Ä–ª–∞–Ω –ê–±–¥—É–ª–ª–∞–µ–≤', position: 'Project Manager', avatar: '–ù–ê' },
            { id: 3, name: '–ê–ª–∏—è –°–º–∏—Ä–Ω–æ–≤–∞', position: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', avatar: '–ê–°' },
            { id: 4, name: '–î–º–∏—Ç—Ä–∏–π –ò–≤–∞–Ω–æ–≤', position: '–î–∏–∑–∞–π–Ω–µ—Ä', avatar: '–î–ò' },
            { id: 5, name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞', position: '–ê–Ω–∞–ª–∏—Ç–∏–∫', avatar: '–ú–ü' },
            { id: 6, name: '–ê—Å—Ö–∞—Ç –ö–∞—Å—ã–º–æ–≤', position: 'DevOps', avatar: '–ê–ö' },
            { id: 7, name: '–°–∞—É–ª–µ –ù—É—Ä–º–∞–≥–∞–º–±–µ—Ç–æ–≤–∞', position: 'QA Engineer', avatar: '–°–ù' },
            { id: 8, name: '–ï–ª–µ–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞', position: 'Frontend Developer', avatar: '–ï–ö' }
        ];
        
        function openParticipantsModal() {
            const participantsModal = document.getElementById('participantsModal');
            participantsModal.style.display = 'flex';
            setTimeout(() => {
                const content = participantsModal.querySelector('.modal-content');
                content.classList.add('show');
            }, 10);
            renderParticipantsList();
        }
        
        function closeParticipantsModal() {
            const participantsModal = document.getElementById('participantsModal');
            const content = participantsModal.querySelector('.modal-content');
            content.classList.remove('show');
            setTimeout(() => {
                participantsModal.style.display = 'none';
            }, 300);
        }
        
        function renderParticipantsList() {
            const tableBody = document.getElementById('participantsTableBody');
            const countDisplay = document.getElementById('selectedCountDisplay');
            
            tableBody.innerHTML = availableUsers.map((user, index) => {
                const isSelected = selectedParticipants.some(p => p.id === user.id);
                return `
                    <tr class="${isSelected ? 'row-selected' : ''}">
                        <td class="text-center">${index + 1}</td>
                        <td>
                            <div class="participant-cell">
                                <div class="participant-avatar-small">${user.avatar}</div>
                                <span>${user.name}</span>
                            </div>
                        </td>
                        <td>${user.position}</td>
                        <td>
                            <span class="status-badge ${isSelected ? 'status-invited' : 'status-not-invited'}">
                                ${isSelected ? '‚úì –ü—Ä–∏–≥–ª–∞—à–µ–Ω' : '–ù–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω'}
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="table-action-btn ${isSelected ? 'btn-remove' : 'btn-invite'}" 
                                    onclick="toggleParticipant(${user.id})">
                                ${isSelected ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å'}
                            </button>
                        </td>
                        <td class="text-center">
                            <button class="send-invite-btn" 
                                    onclick="sendInvitation(${user.id}, '${user.name}')"
                                    title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫—É">
                                üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            if (countDisplay) {
                countDisplay.textContent = selectedParticipants.length;
            }
        }
        
        function filterParticipants() {
            const searchInput = document.getElementById('searchParticipantsInput');
            const filter = searchInput.value.toLowerCase();
            const tableBody = document.getElementById('participantsTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                const position = row.cells[2].textContent.toLowerCase();
                
                if (name.includes(filter) || position.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function toggleParticipant(userId) {
            const user = availableUsers.find(u => u.id === userId);
            const index = selectedParticipants.findIndex(p => p.id === userId);
            
            if (index > -1) {
                selectedParticipants.splice(index, 1);
            } else {
                selectedParticipants.push(user);
            }
            
            renderParticipantsList();
            updateSelectedParticipantsDisplay();
        }
        
        function updateSelectedParticipantsDisplay() {
            const listElement = document.getElementById('selectedParticipantsList');
            const hiddenInput = document.getElementById('meetingParticipants');
            
            if (selectedParticipants.length === 0) {
                listElement.innerHTML = '<p class="no-participants-text">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>';
                hiddenInput.value = '';
            } else {
                listElement.innerHTML = selectedParticipants.map(user => `
                    <div class="selected-participant-chip">
                        <span class="chip-avatar">${user.avatar}</span>
                        <span class="chip-name">${user.name}</span>
                        <button class="chip-remove" onclick="removeParticipant(${user.id})">√ó</button>
                    </div>
                `).join('');
                hiddenInput.value = JSON.stringify(selectedParticipants.map(p => p.id));
            }
        }
        
        function removeParticipant(userId) {
            const index = selectedParticipants.findIndex(p => p.id === userId);
            if (index > -1) {
                selectedParticipants.splice(index, 1);
                updateSelectedParticipantsDisplay();
                renderParticipantsList();
            }
        }
        
        function confirmParticipantsSelection() {
            closeParticipantsModal();
        }
        
        function sendInvitation(userId, userName) {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—â–∞–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
            const meetingTitle = document.getElementById('meetingTitle').value || '–°–æ–≤–µ—â–∞–Ω–∏–µ';
            const meetingDate = document.getElementById('meetingDate').value || '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            const meetingTime = document.getElementById('meetingTime').value || '–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ';
            const meetingDescription = document.getElementById('meetingDescription').value || '';
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const formattedDate = meetingDate ? new Date(meetingDate).toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }) : '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è WhatsApp
            let message = `üîî *–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Å–æ–≤–µ—â–∞–Ω–∏–µ*\n\n`;
            message += `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${userName}!\n\n`;
            message += `–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –í–∞—Å –Ω–∞ —Å–æ–≤–µ—â–∞–Ω–∏–µ:\n\n`;
            message += `üìã *–¢–µ–º–∞:* ${meetingTitle}\n`;
            message += `üìÖ *–î–∞—Ç–∞:* ${formattedDate}\n`;
            message += `üïê *–í—Ä–µ–º—è:* ${meetingTime}\n`;
            
            if (meetingDescription) {
                message += `\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:*\n${meetingDescription}\n`;
            }
            
            message += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `–° —É–≤–∞–∂–µ–Ω–∏–µ–º,\n`;
            message += `ü§ñ PRIME360.AI`;
            
            // –ö–æ–¥–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è URL
            const encodedMessage = encodeURIComponent(message);
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º WhatsApp
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showSuccessNotification(`–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ WhatsApp –¥–ª—è ${userName}`);
        }
        
        function sendProtocolToWhatsApp() {
            const projectName = document.getElementById('selectedProjectName').textContent;
            const table = document.getElementById('protocolTable');
            const rows = table.querySelectorAll('tbody tr');
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            let message = `üìã *${projectName}*\n`;
            message += `üìù –ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            
            let taskNumber = 1;
            rows.forEach(row => {
                const cells = row.cells;
                const taskName = cells[1].querySelector('input').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                const responsible = cells[5].querySelector('select').value || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω';
                const status = cells[6].querySelector('select').value || '-';
                const planDate = cells[3].querySelector('input').value || '-';
                
                message += `*${taskNumber}. ${taskName}*\n`;
                message += `üë§ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: ${responsible}\n`;
                message += `üìÖ –ü–ª–∞–Ω: ${planDate}\n`;
                message += `üìä –°—Ç–∞—Ç—É—Å: ${status}\n`;
                message += `\n`;
                taskNumber++;
            });
            
            message += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: PRIME360.AI\n`;
            message += `üìÖ –î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}`;
            
            // –ö–æ–¥–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è URL
            const encodedMessage = encodeURIComponent(message);
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º WhatsApp
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showSuccessNotification('–ü—Ä–æ—Ç–æ–∫–æ–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ WhatsApp');
        }
        
        function startConference(dateStr, index) {
            const meeting = meetings[dateStr][index];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é
            if (meeting.conferenceLink) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                window.open(meeting.conferenceLink, '_blank');
                showSuccessNotification(`–û—Ç–∫—Ä—ã—Ç–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è: ${meeting.title}`);
            } else {
                // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é (–ø—Ä–∏–º–µ—Ä –¥–ª—è Zoom)
                const meetingId = Math.floor(1000000000 + Math.random() * 9000000000);
                const zoomLink = `https://us05web.zoom.us/j/${meetingId}`;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –≤ —Å–æ–≤–µ—â–∞–Ω–∏–µ
                meeting.conferenceLink = zoomLink;
                saveMeetings();
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                window.open(zoomLink, '_blank');
                showSuccessNotification(`–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –¥–ª—è: ${meeting.title}`);
            }
            
            console.log('–ù–∞—á–∞–ª–æ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏:', meeting.title, '–°—Å—ã–ª–∫–∞:', meeting.conferenceLink);
        }
        
        // Protocol Charts Modal Functions
        function openProtocolChartsModal() {
            const modal = document.getElementById('protocolChartsModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                const content = modal.querySelector('.modal-content');
                content.classList.add('show');
                initProtocolCharts();
            }, 10);
        }
        
        function closeProtocolChartsModal() {
            const modal = document.getElementById('protocolChartsModal');
            const content = modal.querySelector('.modal-content');
            content.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        
        function initProtocolCharts() {
            // –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx && !statusCtx.chart) {
                statusCtx.chart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['–í—ã–ø–æ–ª–Ω–µ–Ω–æ', '–í —Ä–∞–±–æ—Ç–µ', '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ', '–ù–µ –Ω–∞—á–∞—Ç–æ'],
                        datasets: [{
                            data: [45, 30, 8, 17],
                            backgroundColor: [
                                '#10b981',
                                '#3b82f6',
                                '#ef4444',
                                '#94a3b8'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: { size: 13, weight: '600' }
                                }
                            }
                        }
                    }
                });
            }
            
            // –ì—Ä–∞—Ñ–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            const timelineCtx = document.getElementById('timelineChart');
            if (timelineCtx && !timelineCtx.chart) {
                timelineCtx.chart = new Chart(timelineCtx, {
                    type: 'bar',
                    data: {
                        labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω'],
                        datasets: [{
                            label: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                            data: [12, 19, 15, 22, 18, 25],
                            backgroundColor: '#10b981',
                            borderRadius: 6
                        }, {
                            label: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ',
                            data: [3, 2, 4, 1, 3, 2],
                            backgroundColor: '#ef4444',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    padding: 15,
                                    font: { size: 13, weight: '600' }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { font: { size: 12 } }
                            },
                            x: {
                                ticks: { font: { size: 12 } }
                            }
                        }
                    }
                });
            }
        }
    </script>

    <!-- Participants Modal -->
    <div id="participantsModal" class="modal">
        <div class="modal-content participants-modal-content">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">üë•</span>
                    –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å–æ–≤–µ—â–∞–Ω–∏—è
                </h2>
                <button onclick="closeParticipantsModal()" class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body participants-modal-body">
                <div class="participants-table-header">
                    <div class="participants-search">
                        <input type="text" id="searchParticipantsInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏..." class="search-participants-input" oninput="filterParticipants()">
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="participants-table" id="participantsTable">
                        <thead>
                            <tr>
                                <th style="width: 60px;">‚Ññ</th>
                                <th style="width: 220px;">–§–ò–û</th>
                                <th style="width: 180px;">–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                                <th style="width: 130px;">–°—Ç–∞—Ç—É—Å</th>
                                <th style="width: 110px;">–î–µ–π—Å—Ç–≤–∏–µ</th>
                                <th style="width: 100px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody id="participantsTableBody">
                            <!-- Participants will be rendered here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="selected-count-info">
                    –í—ã–±—Ä–∞–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <strong id="selectedCountDisplay">0</strong>
                </div>
                <div class="footer-buttons">
                    <button class="btn-secondary" onclick="closeParticipantsModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" onclick="confirmParticipantsSelection()">
                        <span>‚úì</span>
                        –ì–æ—Ç–æ–≤–æ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Protocol Charts Modal -->
    <div id="protocolChartsModal" class="modal">
        <div class="modal-content protocol-charts-modal-content">
            <div class="modal-header">
                <h2>
                    <span class="modal-icon">üìä</span>
                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
                </h2>
                <button onclick="closeProtocolChartsModal()" class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body charts-modal-body">
                <!-- Statistics Cards -->
                <div class="charts-stats-grid">
                    <div class="chart-stat-card green">
                        <div class="stat-card-icon">‚úÖ</div>
                        <div class="stat-card-value">45</div>
                        <div class="stat-card-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div class="chart-stat-card blue">
                        <div class="stat-card-icon">‚è≥</div>
                        <div class="stat-card-value">30</div>
                        <div class="stat-card-label">–í —Ä–∞–±–æ—Ç–µ</div>
                    </div>
                    <div class="chart-stat-card red">
                        <div class="stat-card-icon">‚ö†Ô∏è</div>
                        <div class="stat-card-value">8</div>
                        <div class="stat-card-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                    </div>
                    <div class="chart-stat-card gray">
                        <div class="stat-card-icon">üìã</div>
                        <div class="stat-card-value">17</div>
                        <div class="stat-card-label">–ù–µ –Ω–∞—á–∞—Ç–æ</div>
                    </div>
                </div>
                
                <!-- Charts Grid -->
                <div class="charts-grid">
                    <div class="chart-block">
                        <h3 class="chart-block-title">üìä –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á</h3>
                        <div class="chart-wrapper">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-block">
                        <h3 class="chart-block-title">üìà –î–∏–Ω–∞–º–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                        <div class="chart-wrapper">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProtocolChartsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn-primary" onclick="exportToExcel()">
                    <span>üì•</span>
                    –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
            </div>
        </div>
    </div>

</body>
</html>

